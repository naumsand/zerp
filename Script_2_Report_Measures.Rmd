---
title: "Child-/parental measures"
output: 
  rmdformats::material:
    highlight: kate
    css: web_style.css
    thumbnails: false
    lightbox: true
    gallery: true
    cards: true
    self_contained: no
    number_sections: no
    code_folding: hide
    fig_caption: yes
---

<!-- Set up workspace -->

```{r setup, include = FALSE, message = FALSE, warning = FALSE}

# Set general settings for Markdown file 
  options(max.print="80")

  knitr::opts_chunk$set(echo=TRUE,
                 prompt=FALSE,
                 tidy=TRUE,
                 comment=NA,
                 message=FALSE,
                 warning=FALSE,
                 results = FALSE,
  	             fig.align="center")
  knitr::opts_knit$set(width=80)
  
# Swipe environment
 rm(list=ls())
  
# Set libraries
  library(afex)
  library(car)
  library(broom)
  library(corrplot)
  library(expss)
  library(foreign)
  library(GGally)
  library(ggpubr)
  library(gtsummary)
  library(kableExtra)
  library(jmv)  
  library(lme4)
  library(miceadds)
  library(pander)
  library(ppcor)
  library(plyr)
  library(psych)
  library(RColorBrewer)
  library(rstatix)
  library(sjPlot)
  library(sjstats)
  library(stats)
  library(tadaatoolbox)
  library(tidyverse)
 
# Round to 2 digits   
  options(digits=2)
   
# Disable scientific notation in R
  options(scipen = 999)
   
# Set figure color palettes
  ZE_col = c("#878787","#D97909")
  
# Set figure theme  
  theme_SN = theme(axis.title.y = element_text(size = 15,
                                               margin = margin(t = 0, r = 20, b = 0, l = 0)),
          panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank(),
          panel.grid.major.y = element_line(colour = "black", linetype = "dotted", size=0.6),
          panel.grid.minor.y = element_blank(),
          panel.border = element_blank(),
          text=element_text(size = 15),
          legend.position = "none")
    

```

```{r prep_data, include = FALSE}

# Load questionnaire data
  load.Rdata(filename="./data/qn_data.Rdata", "qn_data")
  load.Rdata(filename="./data/app_qn.Rdata", "app_qn")

```

# Overall training effect

To compare effectiveness across SEC measures, we calculated z-standardized change scores between participants’ pre- and post-training parent ratings and child assessment scores. Subsequently, we used multivariate analysis of variance (MANOVA) with change scores for all parent and child SEC measures as dependent variables and training (Zirkus Empathico vs. Controls) as between factor.

We detected a significant multivariate effect of training across all SEC child and parent ratings (*F*(8,51) = 2.53, *p* = 0.02, *Pillai* = 0.28), with Zirkus Empathico participants showing larger SEC increases compared to controls. 

```{r manova_no_training_time, results = 'asis'}

# Calculate MANCOVA on standardized change scores 
  ze_manc = as.data.frame(mancova(qn_data,
          deps = vars(zd_GEM_Total, zd_EMK_EM_P, zd_EMK_EM_CH,
                      zd_EMK_EK_P, zd_EMK_EK_CH, zd_EMK_PB_CH, zd_SDQ_PB, zd_SDQ_Total),
          factors = group,
          multivar = list("pillai"))$multivar)
  
# Prepare for printing: Remove and rename columns / values
  ze_manc = as_tibble(ze_manc)
  ze_manc$Variable = factor(ze_manc$`term[pillai]`)
  ze_manc$Pillai = ze_manc$`stat[pillai]`
  ze_manc$F = ze_manc$`f[pillai]`
  ze_manc$df1 = ze_manc$`df1[pillai]`
  ze_manc$df2 = ze_manc$`df2[pillai]`
  ze_manc$p = ze_manc$`p[pillai]`
  
  ze_manc = subset(ze_manc, select = -c(1:7))
  ze_manc$Variable = revalue(ze_manc$Variable, c("group"="Training")) 
  
# Print table 
  pander(ze_manc)  
  
```

# Primary outcome: Empathy

To delineate improvements in single SECs, we calculated separate analyses of covariance (ANCOVAs) for each primary and secondary outcome with training as between factor, covarying for participant’s pre-training scores.

We did not detect group differences for empathy measured by the  Griffith Empathy Measure (GEM) parent rating (GEM P: *F*(1,57) = 0.66, *p* = 0.42). In contrast, Inventory to survey of emotional competences for three- to six-year-old (EMK 3-6) parent ratings indicated larger increases in empathy for the Zirkus Empathico group compared to controls (EMK EM_P: *F*(1,57) = 6.32, *p* = 0.02, $\eta^{2}{p}$ = 0.10). However, no difference was found for EMK child assessments (EMK EM_CH: *F*(1,57) = 1.72, *p* = 0.26).

```{r se_sep_meas_comp_boxplot, results = "asis", fig.width = 8, fig.height = 4}

# Separate data for CG and TG
  qn_data_d_scors = subset(qn_data, select = c(group, zd_GEM_Total, zd_EMK_EM_CH, 
                                               zd_EMK_EM_P, zd_EMK_EK_CH, 
                                               zd_EMK_EK_P, zd_EMK_PB_CH, zd_SDQ_PB, zd_SDQ_Total))
  qn_data_d_scors_TG = subset(qn_data_d_scors, group == "TG")
  qn_data_d_scors_TG = gather(qn_data_d_scors_TG, measure, TG, zd_GEM_Total:zd_SDQ_Total, factor_key=TRUE)
  
  
  qn_data_d_scors_CG = subset(qn_data_d_scors, group == "CG")
  qn_data_d_scors_CG = gather(qn_data_d_scors_CG, measure, CG, zd_GEM_Total:zd_SDQ_Total,factor_key=TRUE)
  names(qn_data_d_scors_CG)[3] = "TG"
  
  qn_data_d_scors = rbind(qn_data_d_scors_TG, qn_data_d_scors_CG)
  names(qn_data_d_scors)[3] = "score"

# Visualize separate training outcomes
  sep_scores_box = ggplot(qn_data_d_scors, aes(x= measure, y=score, fill=group)) +
      # add shaded areas  
  annotate("rect", xmin = 2.6, xmax = 3.4, ymin = -2, ymax = 2.8, alpha = .2)+
  annotate("rect", xmin = 3.6, xmax = 4.4, ymin = -2, ymax = 2.8, alpha = .2)+
  annotate("rect", xmin = 4.6, xmax = 5.4, ymin = -2, ymax = 2.8, alpha = .2)+
  annotate("rect", xmin = 6.6, xmax = 7.4, ymin = -2, ymax = 2.8, alpha = .2)+
  annotate("rect", xmin = 7.6, xmax = 8.4, ymin = -2, ymax = 2.8, alpha = .2)+
  stat_boxplot(geom ='errorbar', width=0.5, size=0.7, coef=1, position=position_dodge(0.65)) +
  geom_boxplot(coef=1, outlier.shape = NA, width=0.7, lwd=1, alpha=1, position=position_dodge(0.65)) +
  labs(x = "", y = "d [z-standardized]") +
  scale_x_discrete(labels=c(expression(GEM[P]), expression(EMK:EM[CH]), expression(EMK:EM[P]), expression(EMK:ER[CH]),
                            expression(EMK:ER[P]), expression(EMK:PB[CH]), expression(SDQ:PB[P]), expression(SDQ:BP[P]))) +
  scale_fill_manual(labels = c("Controls", "Zirkus Empathico"), values = ZE_col) +
  theme_bw()+
  theme_SN +
  theme(axis.text.x = element_text (size = 10), legend.position = "top", legend.title = element_blank(),
        axis.title.y = element_text(size = 10, margin = margin(t = 0, r = 5, b = 0, l = 0)),
        axis.ticks.x=element_blank(), axis.text.y = element_text (size = 10)) +
  coord_cartesian(ylim = c(-2, 2.8), expand = FALSE, clip = "off") +
  # add asteriks  
  annotate('text', x = c(3,4,5,7,8) , y = 2.4, label = '"*"', fontface = "bold", size = 9, parse=TRUE) +
  # add shaded x-axis extension 
  annotate("text", x = 2, y = -2.6, label = "Empathy", size = 4) +
  annotate("text", x = 4.5, y = -2.6, label = "Emotion recognition", size = 4) +
  annotate("text", x = 7, y = -2.6, label = "Prosocial behavior", size = 4)+
  annotate("segment", x = 3.5, xend = 3.5, y = -2.1, yend = -2.5, colour = "gray31")+
  annotate("segment", x = 5.5, xend = 5.5, y = -2.1, yend = -2.5, colour = "gray31")
    
# Show plot  
  sep_scores_box
  
 ggsave(sep_scores_box, file = "zerp_sec_measures.tiff", dpi = 300)  
  
```

<p class="caption"> Parent and child ratings of socio-emotional competence (SEC) reports. Orange: Zirkus Empathico group. Grey: Control training. Error bars indicate standard errors (SE); d z-standardized represents the z-standardized change scores (difference between post- and pre-training values). GEM = Griffith Empathy Measure; EMK = Inventory to survey of emotional competences for three- to six-year-olds; EM = Empathy; ER = Emotion recognition; SDQ = Strength and Difficulties Questionnaire; PB = Prosocial behavior; BP = Behavioral problems. P = parent rating; CH = child assessment.</p>

## GEM

```{r anova_GEM, results = 'asis'}
   
    gem_total_an =  aov_ez("ID", "zd_GEM_Total", qn_data, between = 
                              c("group"),
    covariate = c("z_GEM_T1"),
    observed = c("z_GEM_T1"), factorize = FALSE,
    anova_table = list(correction = "none", es = "pes")) 
    
    
  pander(gem_total_an$anova_table)
   
```

## EMK 3-6 EM CH 

```{r anova_EMK_EM_CH, results = 'asis'}

# ANCOVA EMK_EM_CH

  EMK_EM_CH_an = aov_ez("ID", "zd_EMK_EM_CH", qn_data, between = c("group"),
      covariate = c("z_EMK_EM_CH_T1"),
      observed = c("z_EMK_EM_CH_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(EMK_EM_CH_an$anova_table)  

```

## EMK 3-6 EM P

```{r anova_EMK_EM_P, results = 'asis'}
  
  EMK_EM_P_an = aov_ez("ID", "zd_EMK_EM_P", qn_data, between = c("group"),
      covariate = c("z_EMK_EM_P_T1"),
      observed = c("z_EMK_EM_P_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(EMK_EM_P_an$anova_table)    
  
```

# Secondary outcome: Emotion recognition

To delineate improvements in single SECs, we calculated separate analyses of covariance (ANCOVAs) for each primary and secondary outcome with training as between factor, covarying for participant’s pre-training scores.

Parent ratings and child EMK 3-6 assessments yielded significantly larger increases for emotion recognition in the Zirkus Empathico group compared to controls (EMK ER_P: *F*(1,57) = 7.56, *p* = 0.02, $\eta^{2}{p}$ = 0.12; EMK ER_CH: *F*(1,57) = 9.27, *p* = 0.02, $\eta^{2}{p}$ = 0.14).


## EMK 3-6 ER CH 

```{r anova_EMK_ER_CH, results = 'asis'}
  
  EMK_EK_CH_an = aov_ez("ID", "zd_EMK_EK_CH", qn_data, between = c("group"),
      covariate = c("z_EMK_EK_CH_T1"),
      observed = c("z_EMK_EK_CH_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(EMK_EK_CH_an$anova_table)    
  
```

## EMK 3-6 ER P 

```{r anova_EMK_ER_P, results = 'asis'}
  
  EMK_EK_P_an = aov_ez("ID", "zd_EMK_EK_P", qn_data, between = c("group"),
      covariate = c("z_EMK_EK_P_T1"),
      observed = c("z_EMK_EK_P_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(EMK_EK_P_an$anova_table)    
  
```


# Secondary outcome: Prosocial behavior

To delineate improvements in single SECs, we calculated separate analyses of covariance (ANCOVAs) for each primary and secondary outcome with training as between factor, covarying for participant’s pre-training scores.

The EMK 3-6 child assessment for prosocial behavior did not display group differences (EMK PB CH: *F*(1,57) = 0.16, *p* = 0.70). Strengths and Difficulties Questionnaire (SDQ) parent ratings, however, showed larger increases in prosocial behavior (SDQ PB P: *F*(1,57) = 7.50, *p* = 0.02, $\eta^{2}{p}$ = 0.12) and greater declines in problem behavior for the Zirkus Empathico group compared to controls (SDQ BP_P: *F*(1,57) = 7.46, *p* = 0.02, $\eta^{2}{p}$ = 0.12).

## EMK 3-6 PB CH 

```{r anova_emk_PB_ch, results = 'asis'}
  
  EMK_PB_CH_an = aov_ez("ID", "zd_EMK_PB_CH", qn_data, between = c("group"),
      covariate = c("z_EMK_PB_CH_T1"),
      observed = c("z_EMK_PB_CH_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(EMK_PB_CH_an$anova_table)     

```

## SDQ PB

```{r anova_sdq_PB, results = 'asis'}

  SDQ_PB_an = aov_ez("ID", "zd_SDQ_PB", qn_data, between = c("group"),
      covariate = c("z_SDQ_PB_T1"),
      observed = c("z_SDQ_PB_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(SDQ_PB_an$anova_table)  

```


## SDQ BP 

```{r anova_sdq_total, results = 'asis'}

  SDQ_total_an = aov_ez("ID", "zd_SDQ_Total", qn_data, between = c("group"),
      covariate = c("z_SDQ_T1"),
      observed = c("z_SDQ_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(SDQ_total_an$anova_table)    
```


# Correction for multiple comparisons

P-values of the training effects were corrected for multiple comparisons with the false discovery rate (FDR):

```{r correct_p_univ_ancova_no_comp, results = "asis"}

  p_val_training = c(gem_total_an$anova_table$`Pr(>F)`[1], EMK_EM_P_an$anova_table$`Pr(>F)`[1], EMK_EM_CH_an$anova_table$`Pr(>F)`[1],
                     EMK_EK_P_an$anova_table$`Pr(>F)`[1], EMK_EK_CH_an$anova_table$`Pr(>F)`[1], EMK_PB_CH_an$anova_table$`Pr(>F)`[1],
                     SDQ_PB_an$anova_table$`Pr(>F)`[1], SDQ_total_an$anova_table$`Pr(>F)`[1])
  
  p_corrected = p.adjust(p_val_training, method="fdr")
  
  Variable = c("GEM P", "EMK EM P", "EMK EM CH", "EMK ER P", "EMK ER CH", "EMK PB CH", "SDQ PB", "SDQ BP")
  
  tabl_p_corr = as.data.frame(cbind(Variable, p_corrected))
  
  pander(tabl_p_corr)

```


# Exploratory analysis: Long-term effects 

```{r prep_data_T3}

# Select T3 complete cases
  qn_data_T3 = qn_data[complete.cases(qn_data$GEM_Total_T3), ] 

# Transform from wide to long format  
  qn_data_T2_T1 = subset(qn_data_T3, select = c("ID", "group", "zd_GEM_Total", "zd_EMK_EM_P", "zd_EMK_EK_P",
                                             "zd_SDQ_PB", "zd_SDQ_Total", "z_GEM_T1", "z_EMK_EM_P_T1", "z_EMK_EK_P_T1",
                                             "z_SDQ_PB_T1","z_SDQ_T1"))
  
  qn_data_T3_T1 = subset(qn_data_T3, select = c("ID", "group", "zd_GEM_Total_lt", "zd_EMK_EM_P_lt","zd_EMK_EK_P_lt","zd_SDQ_PB_lt",
                                             "zd_SDQ_Total_lt", "z_GEM_T1", "z_EMK_EM_P_T1", "z_EMK_EK_P_T1",
                                             "z_SDQ_PB_T1","z_SDQ_T1"))
  
# Add time info
  qn_data_T2_T1$time = "short"
  qn_data_T3_T1$time = "long"
  
# Rename columns  
  qn_data_T2_T1 = as_tibble(qn_data_T2_T1) 
  qn_data_T2_T1 = dplyr::rename(qn_data_T2_T1, GEM = zd_GEM_Total,
                                        EMK_EM_P = zd_EMK_EM_P,
                                        EMK_EK_P = zd_EMK_EK_P,
                                        SDQ_PB = zd_SDQ_PB,
                                        SDQ_Total = zd_SDQ_Total)
  
  qn_data_T3_T1 = as_tibble(qn_data_T3_T1) 
  qn_data_T3_T1 = dplyr::rename(qn_data_T3_T1, GEM = zd_GEM_Total_lt,
                                        EMK_EM_P = zd_EMK_EM_P_lt,
                                        EMK_EK_P = zd_EMK_EK_P_lt,
                                        SDQ_PB = zd_SDQ_PB_lt,
                                        SDQ_Total = zd_SDQ_Total_lt)
  
# Combine matrices
  qn_data_T3 = rbind(qn_data_T2_T1, qn_data_T3_T1)

```

Exploratory long-term analyses were conducted including families who completed the three-month follow-up (Zirkus Empathico = 14 participants; Controls = 21 participants). We calculated separate ANCOVAs for each *parent* primary and secondary outcome with training as between factor and time as within factor (T1-T2 vs. T1-T3), covarying for participant’s pre-training scores.

For the GEM, we detected larger increases in empathy for the Zirkus Empathico group compared to controls at three-month follow-up (*F*(1,65) = 6.73, *p* = 0.09, $\eta^{2}{p}$ = 0.16). None of the other outcomes indicated long-term SEC changes:

### Primary outcomes {.tabset .tabset-pills}

#### GEM

```{r ancova_GEM_lt, results = 'asis'}
   
# ANCOVA GEM
  gem_lt_anc =  aov_ez("ID", "GEM", qn_data_T3, between = c("group","time"),
    covariate = c("z_GEM_T1"),
    observed = c("z_GEM_T1"), factorize = FALSE,
    anova_table = list(correction = "none", es = "pes"))

   pander(gem_lt_anc$anova_table)
  
   
```


#### EMK 3-6 EM P

```{r ancova_EMK_EM_P_T3, results = 'asis'}

  EMK_EM_P_lt_anc = aov_ez("ID", "EMK_EM_P", qn_data_T3, between = c("group","time"),
      covariate = c("z_EMK_EM_P_T1"),
      observed = c("z_EMK_EM_P_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(EMK_EM_P_lt_anc$anova_table)

  
```



### Secondary outcomes {.tabset .tabset-pills}

#### EMK 3-6 ER P

```{r ancova_EMK_EK_P_T3, results = 'asis'}

  EMK_EK_P_lt_anc = aov_ez("ID", "EMK_EK_P", qn_data_T3, between = c("group","time"),
      covariate = c("z_EMK_EK_P_T1"),
      observed = c("z_EMK_EK_P_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(EMK_EK_P_lt_anc$anova_table)

```


#### SDQ PB

```{r ancova_sdq_PB_T3, results = 'asis'}

# ANCOVA SDQ_PB

  SDQ_PB_lt_anc = aov_ez("ID", "SDQ_PB", qn_data_T3, between = c("group","time"),
      covariate = c("z_SDQ_PB_T1"),
      observed = c("z_SDQ_PB_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(SDQ_PB_lt_anc$anova_table)
  
```

#### SDQ BP

```{r ancova_sdq_total_T3, results = 'asis'}

# ANCOVA SDQ_Total

  SDQ_total_lt_anc = aov_ez("ID", "SDQ_Total", qn_data_T3, between = c("group","time"),
      covariate = c("z_SDQ_T1"),
      observed = c("z_SDQ_T1"), factorize = FALSE,
      anova_table = list(correction = "none", es = "pes"))
  
  pander(SDQ_total_lt_anc$anova_table)
  
```



# Training fidelity

To examine training fidelity differences between groups, we conducted independent t-tests. Both groups showed high levels of training motivation with similar training engagement across groups (total time used: *t*(58) = 0.4, *p* = .69; weeks: *t*(58) = -1.01, *p* = .32). Parental engagement did not differ between groups (*t*(58) = 0.05, *p* = .96). Parents also indicated that the training was compatable with daily routines (Note: 2 families of the Zirkus Empathico group did not fill out qualitative questions).

```{r training_time_stats, results = "asis"}

# Select srceening variables
  qn_data_train_time = qn_data %>% select(group, T_Self_Report, train_weeks)

# Rename groups
  qn_data_train_time$group = dplyr::recode(qn_data_train_time$group, 
                         CG = "Controls", TG = "Zirkus Empathico")

# Apply labels
  qn_data_train_time = apply_labels(qn_data_train_time,
                      T_Self_Report = "Training time (min)",
                      sibs = "Training duration (weeks)")
# Prepare table
  train_time_table =
    tbl_summary(
      qn_data_train_time,
      by = group, # split table by group
      type = c(T_Self_Report, train_weeks) ~ "continuous",
      statistic = list(all_continuous() ~ "{mean} ({sd})", # descriptives definition
                     all_categorical() ~ "{n} / {N} ({p}%)"),
      digits = all_continuous() ~ 2,
      missing = "no" # don't list missing data separately
    ) %>%
    add_n() %>% # add column with total number of non-missing observations
    modify_header(label = "**Variable**") %>% # update the column header
    bold_labels()
  
# Print table 
  train_time_table
  
  
```

**Training duration (in weeks)**

```{r t_test_training_time, results = "asis"}

tadaa_t.test(
  qn_data_train_time,
  train_weeks,
  group,
  direction = "two.sided",
  paired = FALSE,
  var.equal = TRUE,
  conf.level = 0.95,
  print = c("markdown")) 
```

**Total training time (minutes)**

```{r t_test_training_time_2, results = "asis"}
tadaa_t.test(
  qn_data_train_time,
  T_Self_Report,
  group,
  direction = "two.sided",
  paired = FALSE,
  var.equal = TRUE,
  conf.level = 0.95,
  print = c("markdown"))  
```

```{r fidel_stats_prep}

# Select data for acceptibility questions
  app_stats = as_tibble(app_qn)
  app_stats = app_stats %>% dplyr::select(Fun, Motivation, Practiced_without_parent, 
                                          Use_App_self_explanatory, Use_Training_daily_life,
                                          Behav_Dealing_w_Feelings, Behav_Interest_Languages)
  
# Add training info
  app_stats$group = app_qn$App  
  
# Rename groups
  app_stats$group = dplyr::recode(app_stats$group, 
                         CG = "Controls", TG = "Zirkus Empathico")
  
  app_stats[app_stats$group == "0",] = NA
  
  app_stats = app_stats[complete.cases(app_stats$group),]
  

```

```{r fidel_plot, fig.width = 8, fig.height = 4}

# https://cran.r-project.org/web/packages/sjPlot/vignettes/plot_likert_scales.html

# Recode variable 
  app_stats_lab  = data.frame(lapply(app_stats, factor, ordered=TRUE, 
                          levels=1:5, 
                          labels=c("Do not agree", "Rather not agree", "Partly agree","Rather agree","Agree")))

  app_stats_lab$group = app_stats$group

# Separate by training / control group
  app_stats_ZE = app_stats_lab[app_stats_lab$group == "Zirkus Empathico",]
  app_stats_SB = app_stats_lab[app_stats_lab$group == "Controls",]
  
  app_stats_ZE = subset(app_stats_ZE, select = -c(group))
  app_stats_SB = subset(app_stats_SB, select = -c(group))


# Create main plot  
   
  ZE_fidel = plot_likert(app_stats_ZE, catcount = 5, values = FALSE, wrap.legend.labels = 5,
                geom.colors = c("#f0c99d","#e1943a","#d97909","#6d3d05","#2b1802"),
                rel_heights = c(8, 12),
                title = "Zirkus Empathico",
                wrap.labels = 65,
                reverse.scale = TRUE,
                show.n = FALSE,
                axis.labels = c("","","","","","","",""))+
                theme_bw() +
                theme(legend.position = "bottom", panel.grid.major.x = element_line(color = "grey"),
                   panel.grid.major.y = element_line(colour = "grey"),
                   panel.border = element_blank(),
                   axis.ticks.y = element_blank(), axis.ticks.x = element_blank(),
                   axis.text.x = element_text(size = 5),
                   legend.text = element_text(size = 4),
                   legend.key.size = unit(0.3, "cm"))
    
    
  CT_fidel = plot_likert(app_stats_SB, catcount = 5, values = FALSE, wrap.legend.labels = 5,
                geom.colors = c("#dbdbdb","#b7b7b7","#878787","#515151","#1b1b1b"),
                rel_heights = c(8, 12),
                title = "Controls",
                wrap.labels = 65,
                reverse.scale = TRUE,
                show.n = FALSE,
                legend.labels = NULL,
                axis.labels = c("My child enjoyed the training.",
                                "My child was motivated to do the training.",
                                "My child trained mostly without me.",
                                "The training was self-explanatory.",
                                "The training was compatible with daily routines.",
                                "My child copes better with its own feelings.",
                                "My child is more interested in other languages.")) +
            theme_bw() +
            theme(legend.position = "bottom", panel.grid.major.x = element_line(color = "grey"),
                   panel.grid.major.y = element_line(colour = "grey"),
                   panel.border = element_blank(),
                   axis.ticks.y = element_blank(), axis.ticks.x = element_blank(),
                   axis.text.x = element_text(size = 5),
                   legend.text = element_text(size = 4),
                   legend.key.size = unit(0.3, "cm"))

  fig_fidel = cowplot::plot_grid(CT_fidel, ZE_fidel, nrow = 1, rel_widths=c(1, .45))
  
  fig_fidel

  
```

```{r fidel_stats, results = "asis"}


# Apply labels
  app_stats = apply_labels(app_stats,
                      Fun = "My child enjoyed the training.",
                      Motivation = "My child was motivated to do the training.",
                      Practiced_without_parent = "My child trained mostly without me.",
                      Use_App_self_explanatory = "The training was self-explanatory.",
                      Use_Training_daily_life = "The training was compatible with daily routines.",
                      Behav_Dealing_w_Feelings = "My child copes better with its own feelings.",
                      Behav_Interest_Languages = "My child is more interested in other languages")

# Prepare table
  app_stats_table =
    tbl_summary(
      app_stats ,
      by = group, # split table by group
      type = c(Fun, Motivation, Practiced_without_parent, Use_App_self_explanatory,
                Use_Training_daily_life, Behav_Dealing_w_Feelings, Behav_Interest_Languages) ~ "continuous",
      statistic = list(all_continuous() ~ "{mean} ({sd})", # descriptives definition
                     all_categorical() ~ "{n} / {N} ({p}%)"),
      digits = all_continuous() ~ 2,
      missing = "no" # don't list missing data separately
    ) %>%
    add_n() %>% # add column with total number of non-missing observations
    add_p() %>% # test for a difference between groups
    modify_header(label = "**Variable**") %>% # update the column header
    bold_labels()  
  
  
# Print table
  app_stats_table
  
```

